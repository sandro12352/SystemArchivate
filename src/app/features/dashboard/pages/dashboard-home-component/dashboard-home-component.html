<main class="relative mx-auto px-4 sm:px-6 py-8 min-h-screen bg-gray-50 overflow-hidden">

  <div class="relative z-10 bg-white rounded-2xl p-8 mb-8 shadow-sm border border-gray-100 overflow-hidden">
    <div class="absolute top-0 right-0 w-64 h-64 bg-purple-50 rounded-full -mr-16 -mt-16 opacity-50"></div>

    <div class="relative z-10 grid md:grid-cols-3 gap-8 items-center">
      <div class="md:col-span-2">
        <span class="text-sm font-semibold text-purple-600 uppercase tracking-wider mb-1 block">
          <i class="pi pi-calendar"></i> {{ fechaActual }}
        </span>
        <h2 class="text-4xl font-bold text-gray-800 mb-3">隆Bienvenido {{ user?.nombre_completo }}! </h2>
        <p class="text-gray-600 text-lg mb-6">
          Para comenzar a utilizar todas las funciones, completa tus
          <span class="font-bold text-gray-900">tareas obligatorias de configuraci贸n</span>.
        </p>

        <div class="max-w-md">
          <div class="flex justify-between text-sm mb-2">
            <span class="text-gray-500 font-medium">Progreso de activaci贸n</span>
            <span class="text-purple-600 font-bold">{{ porcentajeProgreso() }}%</span>
          </div>
          <div class="w-full bg-gray-100 rounded-full h-3">
            <div class="bg-linear-to-r from-purple-500 to-indigo-500 h-3 rounded-full transition-all duration-700"
              [style.width.%]="porcentajeProgreso()">
            </div>
          </div>
        </div>
      </div>

      <div class="hidden md:flex justify-end">
        <img src="https://png.pngtree.com/png-clipart/20240503/original/pngtree-happy-person-using-laptop-for-working-through-internet-at-home-vector-png-image_14996858.png" alt="Avatar"
          class="w-32 h-32 rounded-full border-4 border-white shadow-lg">
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">


    <div class="lg:col-span-2 space-y-8">



      <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">

        @if (todasTareasCompletadas()) {
        <div class="p-10 text-center ">
          <div class="relative inline-block">
            <img src="https://img.freepik.com/vector-premium/ilustracion-plana-editable-tarea-completa_9206-3118.jpg" alt="xito"
              class="w-48 mx-auto mb-6 animate-bounce">
            <div class="absolute inset-0 bg-purple-100 rounded-full filter blur-3xl opacity-30 -z-10"></div>
          </div>

          <h2 class="text-3xl font-bold text-gray-800 mb-3">隆Tareas Completadas!</h2>
          <p class="text-gray-500 max-w-md mx-auto text-lg leading-relaxed">
            Has hecho un gran trabajo. Tu documentaci贸n ha sido enviada a
            <span class="text-purple-600 font-semibold">revisi贸n t茅cnica</span>
            y pronto activaremos todas las funciones.
          </p>

          <div class="mt-8">
            <p-button label="Continuar..." icon="pi pi-arrow-right" iconPos="right"
              styleClass="p-button-rounded bg-purple-600 border-none px-8 shadow-md hover:bg-purple-700 transition"
              (onClick)="verifyTask()"
              >
            </p-button>
          </div>
        </div>
        }
        @else {
        <div class="p-6 border-b border-gray-100 bg-gray-50/50">
          <h3 class="text-lg font-bold text-gray-800">Pasos Requeridos</h3>
          <p class="text-sm text-gray-500">Completa estas acciones para activar las dem谩s funciones</p>
        </div>

        <div class="divide-y divide-gray-50">
          @for (tarea of tareasDeCliente(); track tarea.id_cliente_tarea; let i = $index) {
          <div class="p-5 hover:bg-gray-50 transition group flex items-start gap-4">

            <div class="pt-1">
              <p-checkbox [ngModel]="tarea.estado === 'subido'" [binary]="true" [disabled]="true">
              </p-checkbox>
            </div>

            <div class="flex-1">
              <div class="flex justify-between items-start gap-2">

                <div class="flex items-center gap-2 flex-wrap">
                  <label class="font-semibold transition duration-300" [class.text-gray-400]="tarea.estado === 'subido'"
                    [class.line-through]="tarea.estado === 'subido'" [class.text-gray-800]="tarea.estado !== 'subido'">
                    {{ tarea.tarea.nombre }}
                  </label>

                  @if (tarea.estado !== 'subido') {
                  <button type="button"
                    class="text-blue-600 hover:text-indigo-800 transition p-1 rounded-md hover:bg-blue-50"
                    (click)="fileInput.click()" title="Subir archivo">
                    <i class="pi pi-cloud-upload text-sm hover:cursor-pointer"></i>
                  </button>
                  }

                  @if (isUploading(tarea)) {
                  <i class="pi pi-spin pi-spinner text-blue-500 text-sm"></i>
                  }

                  @if (!isUploading(tarea) && getNombreArchivo(tarea)) {
                  <span class="text-xs bg-gray-100 px-2 py-0.5 rounded text-gray-600 truncate max-w-[150px]"
                    [title]="getNombreArchivo(tarea)">
                    <i class="pi pi-file text-[10px] mr-1"></i>{{ getNombreArchivo(tarea) }}
                  </span>
                  }

                  <input #fileInput type="file" class="hidden" (change)="onFileSelected($event, tarea)"
                    [disabled]="isUploading(tarea)">
                </div>

                <span class="px-2 py-1 rounded text-[10px] font-bold uppercase tracking-tight whitespace-nowrap"
                  [ngClass]="{
                      'bg-gray-100 text-gray-500': tarea.estado === 'pendiente',
                      'bg-blue-100 text-blue-600': tarea.estado === 'subido',
                      'bg-yellow-100 text-yellow-700': tarea.estado === 'en_revision',
                      'bg-green-100 text-green-600': tarea.estado === 'aprobado',
                      'bg-red-100 text-red-600': tarea.estado === 'rechazado'
                    }">
                  {{ tarea.estado.replace('_', ' ') }}
                </span>
              </div>

              <p class="text-sm text-gray-500 mt-1 leading-snug">
                {{ tarea.tarea.descripcion }}

                @if (i === 2) {
                <br>
                <a href="https://form.jotform.com/260046354543049"
                  class="text-blue-600 hover:underline inline-flex items-center gap-1 mt-1" target="_blank">
                  Completar formulario <i class="pi pi-external-link text-[10px]"></i>
                </a>
                }
              </p>
            </div>
          </div>
          }
        </div>
        }
      </div>
    </div>

    <p-card class="rounded-xl shadow-sm">

      <!-- Header del Card -->
      <ng-template pTemplate="header">
        <div class="px-6 pt-2">
          <h3 class="text-xl font-bold text-gray-800">
            Gu铆a de activaci贸n
          </h3>
          <p class="text-sm text-gray-500">
            Sigue estos pasos para completar la configuraci贸n inicial
          </p>
        </div>
      </ng-template>

      <!-- Content -->
      <div class="space-y-6">

        <p-stepper [value]="1">

          <!-- PASO 1 -->
          <p-step-item [value]="1">
            <p-step>
              <p class="text-base  text-gray-900 tracking-tight text-start">Completar tareas</p>
              <div class="text-sm text-gray-500 mt-0.5">
                Finaliza las acciones obligatorias para activar todas las funciones.
              </div>
            </p-step>
            <p-step-panel>
              <ng-template #content let-activateCallback="activateCallback">
                <div class="flex flex-col gap-4 h-54 p-4">

                  <h4 class="text-lg font-bold text-gray-800">
                    Completa las tareas asignadas
                  </h4>

                  <p class="text-sm text-gray-600">
                    Finaliza las acciones obligatorias para activar todas las funciones del sistema.
                  </p>

                  <ul class="list-disc pl-5 text-sm text-gray-700 space-y-1">
                    <li>Completar informaci贸n de perfil</li>
                    <li>Configurar preferencias b谩sicas</li>
                    <li>Validar datos principales</li>
                  </ul>

                  <div class="flex justify-center">
                    <img src="https://illustrations.popsy.co/amber/work-from-home.svg" alt="Completar tareas"
                      class="max-h-48" />
                  </div>

                </div>
              </ng-template>
            </p-step-panel>
          </p-step-item>

          <!-- PASO 2 -->
          <p-step-item [value]="2">
            <p-step>Primer uso</p-step>
            <p-step-panel>
              <ng-template #content let-activateCallback="activateCallback">
                <div class="flex flex-col gap-2 h-50">

                  <h4 class="text-lg font-bold text-gray-800">
                    Realiza tu primera acci贸n
                  </h4>

                  <p class="text-sm text-gray-600">
                    Ejecuta una acci贸n clave para comenzar a utilizar el sistema.
                  </p>

                  <ul class="list-disc pl-5 text-sm text-gray-700 space-y-1">
                    <li>Crear tu primer registro</li>
                    <li>Visualizar un reporte</li>
                    <li>Explorar el panel principal</li>
                  </ul>

                  <div class="flex justify-center">
                    <img src="https://illustrations.popsy.co/amber/product-launch.svg" alt="Primer uso"
                      class="max-h-48" />
                  </div>

                </div>
              </ng-template>
            </p-step-panel>
          </p-step-item>

          <!-- PASO 3 -->
          <p-step-item [value]="3">
            <p-step>Cuenta activa</p-step>
            <p-step-panel>
              <ng-template #content let-activateCallback="activateCallback">
                <div class="flex flex-col gap-4 h-55  ">

                  <h4 class="text-lg font-bold text-gray-800">
                    Cuenta lista para usar
                  </h4>

                  <p class="text-sm text-gray-600">
                    Has completado la configuraci贸n inicial. Ya puedes usar todas las funciones.
                  </p>

                  <div class="flex justify-center">
                    <img src="https://illustrations.popsy.co/amber/success.svg" alt="Cuenta activa" class="max-h-48" />
                  </div>

                </div>
              </ng-template>
            </p-step-panel>
          </p-step-item>

        </p-stepper>

      </div>

    </p-card>



  </div>

  <div class="mt-12 bg-white rounded-2xl p-8 shadow-sm border border-gray-100">
    <div class="flex justify-between items-center mb-8">
      <div>
        <h3 class="text-xl font-bold text-gray-800">Centro de Aprendizaje</h3>
        <p class="text-gray-500 text-sm">Videos cortos para dominar el sistema r谩pidamente</p>
      </div>
      <p-button label="Ver todos los cursos" icon="pi pi-external-link"
        styleClass="p-button-text p-button-sm"></p-button>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      @for (video of videos; track $index) {
      <div class="group cursor-pointer">
        <div class="relative rounded-xl overflow-hidden mb-3 aspect-video shadow-sm bg-gray-100">
          <img [src]="video.thumbnail" [alt]="video.titulo"
            class="w-full h-full object-cover opacity-90 group-hover:scale-105 transition duration-500">

          <div class="absolute inset-0 bg-black/40 flex justify-center items-center 
             opacity-0 group-hover:opacity-100 transition-opacity duration-300">

            <div class="transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300">
              <p-button icon="pi pi-play" styleClass="p-button-rounded p-button-raised bg-purple-600 border-none">
              </p-button>
            </div>
          </div>

          <span
            class="absolute bottom-3 right-3 bg-black/80 text-white text-[10px] px-2 py-1 rounded-md font-bold backdrop-blur-sm">
            {{ video.duracion }}
          </span>
        </div>

        <h4 class="font-bold text-gray-800 group-hover:text-purple-600 transition truncate">
          {{ video.titulo }}
        </h4>
        <p class="text-xs text-gray-500 mt-2 flex items-center gap-2">
          <i class="pi pi-tag text-[10px]"></i> {{ video.categoria }}
        </p>
      </div>
      }

    </div>


  </div>

</main>